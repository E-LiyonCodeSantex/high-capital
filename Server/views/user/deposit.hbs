<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User | Deposit</title>
    <!--forawesome-->
    <script src="https://kit.fontawesome.com/d5a2a27062.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/loggedInStyle.css">
</head>

<body>
    <section>
        <div class="header">
            <a href="/user/Dashboard" class="a color-gradient"> Access Your Dashboard</a>
            <p class="header">Deposit</p>
        </div>

        <form action="/user/deposit" class="deposit-form gap-and-padding dark-color margin-bottom" method="POST"
            enctype="multipart/form-data">


            {{#if errorMessage}}
            <div class="status-unconfirmed">{{errorMessage}}</div>
            {{/if}}
            <div class="form-group">
                <label>Amount:</label>
                <input type="number" name="amount" class="darker-color select-input" required min="1" step="any">
            </div>

            <div class="form-group">
                <label>Method:</label>
                <select name="method" class="darker-color select-input" required>
                    <option value="select">Select withdrawal method</option>
                    <option value="bank">Bank</option>
                    <option value="crypto" id="wallet-to-withdarw">Crypto</option>
                </select>
            </div>

            <div id="crypto-fields" class=" select-input withdrawal-adress-field" style="display:none;">
                <div class="form-group">
                    <label>Select wallet to deposit into:</label>
                    <select id="select-wallet" name="asset" class="select-input" required>
                        <option value="" disabled selected>Select Wallet</option>

                        {{#each wallets}}
                        <option value="{{this.name}}" data-address="{{address}}">{{name}}</option>
                        {{/each}}
                    </select>
                </div>
                <div class="form-group">
                    <label>Click to copy wallet Address:</label>
                    <input type="text" value="" name="" id="wallet-address" readonly onclick="copyToClipboard('wallet-address')"
                        style="border: 1px solid #ffffff !important;">
                    <input type="hidden" value="" name="depositAddress" id="wallet-address-hidden">
                </div>
                <div class="form-group">
                    <label>Upload Receipt:</label>
                    <input type="file" name="transaction_receipt" id="receipt-upload-crypto" accept=".jpg,.jpeg,.png,.pdf"
                        required style="border: 1px solid #ffffff !important;">
                    <small>Accepted formats: JPG, PNG, PDF</small>
                </div>


            </div>
            <div id="bank-fields" class="darker-color select-input withdrawal-adress-field" style="display:none;">
                <div class="form-group">
                    <label>Select wallet to deposit into:</label>
                    <select name="bankName" class="select-input" required id="bank-select">
                        <option value="">Select Bank</option>
                        {{#each bankNames}}
                        <option value="{{bankName}}" data-account="{{number}}" data-name="{{account}}">
                            {{bankName}}
                        </option>
                        {{/each}}
                    </select>

                </div>
                <div class="form-group">
                    <label>click to copy acount number:</label>
                    <input type="number" name="acountNumber" id="bank-account-number" readonly
                        onclick="copyToClipboard('bank-account-number')">
                </div>
                <div class="form-group">
                    <label>Acount Name:</label>
                    <input type="text" name="acountName" id="bank-account-name" readonly>
                </div>
                 <div class="form-group">
                    <label>Upload Receipt:</label>
                    <input type="file" name="transaction_receipt" id="receipt-upload-bank" accept=".jpg,.jpeg,.png,.pdf"
                        required style="border: 1px solid #ffffff !important;">
                    <small>Accepted formats: JPG, PNG, PDF</small>
                </div>
            </div>

            <button type="submit" class="submit-button"> Deposit into your acount <i class="fa fa-sign-in"></i></button>
        </form>

        <a href="/user/history" class="submit-button"> View History</a>

          {{#if deposits.length}}
        <h3 class="header">Your Deposits</h3>
        <div class="withdrawal-request">
            {{#each deposits}}
            <!-- ...your withdrawal card... -->
            <div class="withdrawal-table">
                <p>
                    <span class="">Amount:</span>
                    <span class="color-gradient">${{amount}}</span>
                </p>

                <p>
                    <span class="">Method:</span>
                    <span class="color-gradient">{{capitalize method}}</span>
                </p>

                <p>
                    <span class="">Wallet/Bank:</span>
                    <span class="color-gradient">
                        {{#if walletName}}{{capitalize walletName}}{{/if}}
                        {{#if bankName}}{{capitalize bankName}}{{/if}}
                    </span>
                </p>

                <p>
                    <span class="">Adress/Ac Number:</span>
                    <span class="color-gradient">
                        {{#if acountNumber}}{{acountNumber}}{{/if}}
                        {{#if walletAddress}}{{walletAddress}}{{/if}}
                    </span>
                </p>

                <p>
                    <span class="">Status:</span>
                    {{#if (eq status "pending")}}
                    <span class="status-unconfirmed">Pending</span>
                    {{else if (eq status "Successful")}}
                    <span class="status-completed">Successful</span>
                    {{/if}}
                </p>

                <p>
                    <span class="">Requested At:</span>
                    <span class="color-gradient requested-at" data-date="{{requestedAt}}"></span>
                </p>

                <p>
                    <span class="">Approved At:</span>
                    <span class="color-gradient requested-at" data-date="{{processedAt}}"></span>
                </p>

            </div>
            {{/each}}
        </div>
        {{else}}
        <p class="no-withdrawal-request">No withdrawal requests found.</p>
        {{/if}}

        <!-- JavaScript to handle image zoom -->
        <script>
            // Show/hide fields based on method
            document.querySelector('select[name="method"]').addEventListener('change', function () {
                document.getElementById('crypto-fields').style.display = this.value === 'crypto' ? '' : 'none';
                document.getElementById('bank-fields').style.display = this.value === 'bank' ? '' : 'none';
            });
        </script>

        <!-- Format requestedAt and processedAt dates -->
        <script>
            document.querySelectorAll('.requested-at').forEach(function (el) {
                const raw = el.getAttribute('data-date');
                if (!raw || raw === "null") {
                    el.textContent = "Pending";
                } else {
                    const date = new Date(raw);
                    if (isNaN(date.getTime())) {
                        el.textContent = "Pending";
                    } else {
                        el.textContent = date.toString().split(' GMT')[0];
                    }
                }
            });
        </script>


    </section>


    <!-- Image Zoom Modal -->
    <div id="image-zoom-modal" class="image-zoom-modal" style="display:none;">
        <span id="close-zoom" class="close-zoom">&times;</span>
        <img id="zoomed-image" class="zoomed-image" src="" alt="Zoomed Receipt" />
    </div>


    <script src="/deposit.js"></script>
    <script src="/script.js"></script>
    <script id="deposit-data" type="application/json">{{{ depositsJSON }}}</script>
    <script id="wallet-data" type="application/json">{{{ walletJSON }}}</script>
    <script id="bank-data" type="application/json">{{{ bankNamesJSON }}}</script>
</body>

</html>